# åç«¯å®ç°å¿«é€Ÿå‚è€ƒ

## ğŸ“‹ æ ¸å¿ƒæ•°æ®è¡¨ï¼ˆ6ä¸ªï¼‰âœ… å·²å®Œæ•´å®ç°

| è¡¨å | SQLAlchemyæ¨¡å‹ | è¯´æ˜ | å…³é”®å­—æ®µ | çŠ¶æ€ |
|------|---|------|--------|------|
| **users** | `User` | ç”¨æˆ·è®¤è¯ä¸èµ„æ–™ | id, username, email, password_hash, avatar_url, bio, is_active | âœ… å®Œæ•´ |
| **items** | `Item` | å•†å“å‘å¸ƒä¸ç®¡ç† | id, seller_id, title, price, **stock**, category, image_url, is_active | âœ… å®Œæ•´ |
| **orders** | `Order` | è®¢å•ç®¡ç†ä¸çŠ¶æ€è¿½è¸ª | id, buyer_id, total_amount, status, shipping_address | âœ… å®Œæ•´ |
| **order_items** | `OrderItem` | è®¢å•-å•†å“å…³è” | id, order_id, item_id, quantity, price_at_purchase | âœ… å®Œæ•´ |
| **addresses** | `Address` | ç”¨æˆ·æ”¶è´§åœ°å€ | id, user_id, recipient_name, phone, detail, is_default | âœ… å®Œæ•´ |
| **reviews** | `Review` | äº¤æ˜“è¯„ä»·ä¸åé¦ˆ | id, item_id, order_id, reviewer_id, reviewee_id, rating, content | âœ… å®Œæ•´ |

**æ¨¡å‹å…³ç³»ï¼š**
- User â†’ items (ä¸€å¯¹å¤šï¼Œå–å®¶)
- User â†’ orders (ä¸€å¯¹å¤šï¼Œä¹°å®¶)
- User â†’ addresses (ä¸€å¯¹å¤š)
- User â†’ reviews_given (ä¸€å¯¹å¤šï¼Œè¯„ä»·è€…)
- User â†’ reviews_received (ä¸€å¯¹å¤šï¼Œè¢«è¯„ä»·è€…)
- Item â†’ order_items (ä¸€å¯¹å¤š)
- Item â†’ reviews (ä¸€å¯¹å¤š)
- Order â†’ order_items (ä¸€å¯¹å¤šï¼Œçº§è”åˆ é™¤)
- Order â†’ reviews (ä¸€å¯¹å¤š)

---

## ğŸ”‘ APIæ¥å£å®ç°çŠ¶æ€

### ç”¨æˆ·è®¤è¯æ¨¡å— âœ… å®Œæ•´å®ç°ï¼ˆ5ä¸ªï¼‰
```
âœ… POST   /api/user/register              ç”¨æˆ·æ³¨å†Œï¼ˆé‚®ç®±éªŒè¯ @seu.edu.cnï¼‰
âœ… POST   /api/user/login                 ç”¨æˆ·ç™»å½•ï¼ˆè¿”å›JWT tokenï¼‰
âœ… POST   /api/user/logout                ç”¨æˆ·ç™»å‡º
âœ… GET    /api/user/checkUsername/{name}  æ£€æŸ¥ç”¨æˆ·åå¯ç”¨æ€§
âœ… GET    /api/user/checkEmail/{email}    æ£€æŸ¥é‚®ç®±å¯ç”¨æ€§
```

**å®ç°ç»†èŠ‚ï¼š**
- å¯†ç å“ˆå¸Œï¼šbcrypt (rounds=12)ï¼Œè‡ªåŠ¨åŠ ç›
- é‚®ç®±éªŒè¯ï¼šå¿…é¡»ä»¥ @seu.edu.cn ç»“å°¾
- Tokenç”Ÿæˆï¼šJWT (HS256)ï¼Œè¿‡æœŸæ—¶é—´ 168å°æ—¶
- é”™è¯¯å¤„ç†ï¼šç»Ÿä¸€APIå“åº”æ ¼å¼

### ç”¨æˆ·èµ„æ–™æ¨¡å— âœ… å®Œæ•´å®ç°ï¼ˆ3ä¸ªï¼‰
```
âœ… GET    /api/users/current              è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ï¼ˆéœ€authï¼‰
âœ… GET    /api/users/{userId}/profile     è·å–ç”¨æˆ·å…¬å¼€èµ„æ–™
âœ… PUT    /api/users/profile              æ›´æ–°å½“å‰ç”¨æˆ·èµ„æ–™ï¼ˆéœ€authï¼‰
```

**å®ç°ç»†èŠ‚ï¼š**
- ç”¨æˆ·è¯„åˆ†è®¡ç®—ï¼šåŸºäºæ”¶åˆ°çš„reviewsï¼ˆ1-5æ˜Ÿï¼‰
- éšç§ä¿æŠ¤ï¼šéƒ¨åˆ†å­—æ®µä»…å¯¹æœ¬äººå¯è§
- æƒé™æ£€æŸ¥ï¼šæ›´æ–°èµ„æ–™éœ€TokenéªŒè¯

### å•†å“æ¨¡å— âœ… å®Œæ•´å®ç°ï¼ˆ7ä¸ªï¼‰
```
âœ… GET    /api/item/getFeatured           é¦–é¡µæ¨èå•†å“ï¼ˆæŒ‰æµè§ˆé‡æ’åºï¼‰
âœ… POST   /api/item/search                é«˜çº§æœç´¢ï¼ˆå…³é”®è¯+åˆ†ç±»+ä»·æ ¼+æ’åºï¼‰
âœ… POST   /api/item/getByCategory         æŒ‰åˆ†ç±»æµè§ˆå•†å“
âœ… GET    /api/item/getDetail/{itemId}    å•†å“è¯¦æƒ…é¡µ
âœ… POST   /api/item/publish               å‘å¸ƒæ–°å•†å“ï¼ˆéœ€authï¼‰
âœ… PUT    /api/item/update/{itemId}       æ›´æ–°å•†å“ï¼ˆéœ€authï¼Œä»…å–å®¶å¯ä¿®æ”¹ï¼‰
âœ… DELETE /api/item/delete/{itemId}       åˆ é™¤å•†å“ï¼ˆéœ€authï¼Œä»…å–å®¶å¯åˆ é™¤ï¼‰
```

**å®ç°ç»†èŠ‚ï¼š**
- æœç´¢ï¼šå¤§å°å†™ä¸æ•æ„Ÿï¼ˆMySQL COLLATE utf8mb4_unicode_ciï¼‰
- æ’åºæ–¹å¼ï¼šlatestï¼ˆæœ€æ–°ï¼‰ã€popularï¼ˆçƒ­é—¨-æŒ‰viewsï¼‰ã€price-ascã€price-desc
- åˆ†é¡µï¼špageã€limit å‚æ•°ï¼Œè¿”å› pagination ä¿¡æ¯
- åº“å­˜ç®¡ç†ï¼šstockå­—æ®µï¼Œåˆ›å»ºè®¢å•æ—¶æ‰£å‡
- å•†å“åˆ†ç±»ï¼šbooksã€electronicsã€dailyã€sportsã€clothesã€other

### è´­ç‰©è½¦æ¨¡å— â³ å‰ç«¯ç®¡ç†ï¼ˆ5ä¸ªï¼Œæ— åç«¯æŒä¹…åŒ–ï¼‰
```
â³ å‰ç«¯sessionStorageç®¡ç†ï¼Œæ— åç«¯API
â€¢ æ·»åŠ å•†å“ï¼šCartManager.add(itemId, quantity)
â€¢ è·å–è´­ç‰©è½¦ï¼šCartManager.getAll()
â€¢ æ›´æ–°æ•°é‡ï¼šCartManager.update(itemId, quantity)
â€¢ åˆ é™¤å•†å“ï¼šCartManager.delete(itemId)
â€¢ æ¸…ç©ºè´­ç‰©è½¦ï¼šCartManager.clear()
```

**å®ç°ç‰¹ç‚¹ï¼š**
- ä¸´æ—¶å­˜å‚¨ï¼šsessionStorageï¼ˆé¡µé¢åˆ·æ–°ä¿ç•™ï¼Œæµè§ˆå™¨å…³é—­æ¸…ç©ºï¼‰
- ä¸æŒä¹…åŒ–ï¼šæŒ‰é¡¹ç›®è¦æ±‚ï¼Œè´­ç‰©è½¦ä¸å­˜å‚¨åˆ°æ•°æ®åº“
- ç»“è´¦æ—¶éªŒè¯ï¼šPOST /api/orders æ—¶å®æ—¶æ£€æŸ¥åº“å­˜

### è®¢å•æ¨¡å— ğŸ”„ éƒ¨åˆ†å®ç°ï¼ˆ8ä¸ªï¼Œæ ¸å¿ƒé€»è¾‘å°±ç»ªï¼‰
```
ğŸ”„ POST   /api/orders                     åˆ›å»ºè®¢å•ï¼ˆäº‹åŠ¡å¤„ç†ï¼Œéœ€å®ç°ï¼‰â­
â³ GET    /api/orders                     è®¢å•åˆ—è¡¨ï¼ˆéœ€å®ç°ï¼‰
â³ GET    /api/orders/{orderId}           è®¢å•è¯¦æƒ…ï¼ˆéœ€å®ç°ï¼‰
â³ PUT    /api/orders/{orderId}/status    æ›´æ–°è®¢å•çŠ¶æ€ï¼ˆéœ€å®ç°ï¼‰
â³ DELETE /api/orders/{orderId}           å–æ¶ˆè®¢å•ï¼ˆåº“å­˜å›æ»šï¼Œéœ€å®ç°ï¼‰
âœ… GET    /api/addresses                  åœ°å€åˆ—è¡¨ï¼ˆç»“æ„å·²å®šä¹‰ï¼‰
âœ… POST   /api/addresses                  æ·»åŠ åœ°å€ï¼ˆç»“æ„å·²å®šä¹‰ï¼‰
âœ… PUT    /api/addresses/{addressId}      æ›´æ–°åœ°å€ï¼ˆç»“æ„å·²å®šä¹‰ï¼‰
```

**å…³é”®å®ç°ï¼ˆOrderServiceï¼‰ï¼š**
```python
# è®¢å•åˆ›å»ºæµç¨‹ï¼ˆéœ€å®ç°äº‹åŠ¡ï¼‰
def create_order(buyer_id, items_data, address_id):
    # 1. å¼€å¯äº‹åŠ¡ (BEGIN TRANSACTION)
    # 2. é”å®šåº“å­˜è¡Œ (SELECT FOR UPDATE)
    # 3. æ£€æŸ¥åº“å­˜æ˜¯å¦å……è¶³
    # 4. æ‰£å‡åº“å­˜ (UPDATE items SET stock = stock - quantity)
    # 5. åˆ›å»ºè®¢å•è®°å½• (INSERT INTO orders)
    # 6. åˆ›å»ºè®¢å•æ˜ç»† (INSERT INTO order_items)
    # 7. æäº¤æˆ–å›æ»š (COMMIT or ROLLBACK)
```

### è¯„ä»·æ¨¡å— â³ ç»“æ„å·²å®šä¹‰ï¼ˆ3ä¸ªï¼Œå¾…å®ç°ï¼‰
```
â³ POST   /api/reviews                    åˆ›å»ºè¯„ä»·ï¼ˆéœ€å®ç°ï¼‰
â³ GET    /api/reviews/item/{itemId}      å•†å“è¯„ä»·åˆ—è¡¨ï¼ˆéœ€å®ç°ï¼‰
â³ GET    /api/reviews/user/{userId}      ç”¨æˆ·è¯„ä»·åˆ—è¡¨ï¼ˆéœ€å®ç°ï¼‰
```

---

## âš¡ å…³é”®å¤æ‚åº¦åˆ†æ

### æœ€å¤æ‚ â­â­â­ è®¢å•åˆ›å»ºï¼ˆäº‹åŠ¡å¤„ç† + åº“å­˜é”å®šï¼‰

**ä¸ºä»€ä¹ˆå¤æ‚ï¼š**
- å¹¶å‘æ§åˆ¶ï¼šå¤šä¸ªç”¨æˆ·åŒæ—¶ä¸‹å•ï¼Œåº“å­˜å¿…é¡»åŸå­æ€§æ‰£å‡
- ACIDäº‹åŠ¡ï¼šéœ€è¦ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼ˆæ‰€æœ‰æ“ä½œåŒæ—¶æˆåŠŸæˆ–å›æ»šï¼‰
- è¡Œçº§é”ï¼šä½¿ç”¨ SELECT FOR UPDATE é˜²æ­¢åº“å­˜å†²çª

**å®ç°æ€è·¯ï¼ˆä½¿ç”¨SQLAlchemyäº‹åŠ¡ï¼‰ï¼š**
```python
from app.models import db, Item, Order, OrderItem

@staticmethod
def create_order(buyer_id, items_data, address_id):
    """
    items_data: [{'item_id': 1, 'quantity': 2}, ...]
    """
    try:
        # å¼€å¯äº‹åŠ¡
        with db.session.begin_nested():
            # 1. é”å®šæ‰€æœ‰å•†å“ï¼ˆé˜²æ­¢å¹¶å‘ï¼‰
            for item_info in items_data:
                item = Item.query.with_for_update().get(item_info['item_id'])
                
                # 2. æ£€æŸ¥åº“å­˜
                if item.stock < item_info['quantity']:
                    raise Exception(f"å•†å“ {item.title} åº“å­˜ä¸è¶³")
                
                # 3. æ‰£å‡åº“å­˜
                item.stock -= item_info['quantity']
            
            # 4. åˆ›å»ºè®¢å•
            total_amount = sum(...)
            order = Order(
                buyer_id=buyer_id,
                total_amount=total_amount,
                status='pending',
                shipping_address=address.detail
            )
            db.session.add(order)
            db.session.flush()  # è·å–è®¢å•ID
            
            # 5. åˆ›å»ºè®¢å•æ˜ç»†
            for item_info in items_data:
                item = Item.query.get(item_info['item_id'])
                order_item = OrderItem(
                    order_id=order.id,
                    item_id=item_info['item_id'],
                    quantity=item_info['quantity'],
                    price_at_purchase=item.price
                )
                db.session.add(order_item)
        
        # 6. è‡ªåŠ¨COMMIT
        db.session.commit()
        return {'success': True, 'order_id': order.id}
        
    except Exception as e:
        # å¼‚å¸¸æ—¶è‡ªåŠ¨ROLLBACKï¼Œåº“å­˜æ¢å¤
        db.session.rollback()
        return {'success': False, 'message': str(e)}
```

**æµ‹è¯•å¹¶å‘ä¸‹å•ï¼š**
```bash
# å¹¶å‘æµ‹è¯•ï¼šåŒæ—¶å‘é€å¤šä¸ªè®¢å•è¯·æ±‚ï¼ŒéªŒè¯åº“å­˜ä¸ä¼šè´Ÿæ•°
for i in {1..10}; do
  curl -X POST http://localhost:5000/api/orders \
    -H "Authorization: Bearer $TOKEN" \
    -H "Content-Type: application/json" \
    -d '{"items":[{"item_id":1,"quantity":1}],"address_id":1}' &
done
wait
# æ£€æŸ¥æ•°æ®åº“ï¼š
# SELECT stock FROM items WHERE id = 1;
# åº”è¯¥æ°å¥½å‡å°‘10ä¸ªï¼Œä¸ä¼šè¶…å–
```

### æ¬¡å¤æ‚ â­â­ æœç´¢ä¸åˆ†ç±»ï¼ˆå·²å®ç°ï¼‰

**å®ç°çš„åŠŸèƒ½ï¼š**
```python
# app/services/item_service.py - ItemService.search_items()
# æ”¯æŒï¼š
# 1. å…³é”®è¯æœç´¢ï¼ˆå¤§å°å†™ä¸æ•æ„Ÿï¼‰
# 2. å¤šç§æœç´¢ç±»å‹ï¼štitle / seller / category
# 3. ä»·æ ¼èŒƒå›´è¿‡æ»¤
# 4. åˆ†ç±»è¿‡æ»¤
# 5. å¤šç§æ’åºï¼šlatest / popular / price-asc / price-desc
# 6. åˆ†é¡µæ”¯æŒ

# SQLç¤ºä¾‹ï¼ˆSQLAlchemyç”Ÿæˆï¼‰
items = Item.query.filter(
    Item.is_active == True,
    Item.title.ilike(f'%{query}%'),  # å¤§å°å†™ä¸æ•æ„Ÿ
    Item.category == category,
    Item.price.between(min_price, max_price)
).order_by(Item.created_at.desc()).paginate(page, limit)
```

**æ€§èƒ½ä¼˜åŒ–ï¼ˆå·²å»ºç«‹ç´¢å¼•ï¼‰ï¼š**
```sql
-- database/schema.sql å·²å®šä¹‰çš„ç´¢å¼•
CREATE INDEX idx_category ON items(category);
CREATE INDEX idx_price ON items(price);
CREATE INDEX idx_created_at ON items(created_at);
CREATE INDEX idx_seller_id ON items(seller_id);
-- å…¨æ–‡ç´¢å¼•
FULLTEXT INDEX idx_search ON items(title, description);
```

### æ¬¡å¤æ‚ â­â­ å¯†ç å®‰å…¨å­˜å‚¨ï¼ˆå·²å®ç°ï¼‰

**å®ç°æ–¹å¼ï¼š**
```python
# app/utils/password_helper.py
from bcrypt import hashpw, gensalt, checkpw

class PasswordHelper:
    @staticmethod
    def hash_password(password: str) -> str:
        """ä½¿ç”¨bcryptåŠ ç›å“ˆå¸Œï¼ˆrounds=12ï¼‰"""
        return hashpw(password.encode('utf-8'), gensalt(rounds=12)).decode('utf-8')
    
    @staticmethod
    def verify_password(password: str, hashed: str) -> bool:
        """éªŒè¯å¯†ç """
        return checkpw(password.encode('utf-8'), hashed.encode('utf-8'))

# ä½¿ç”¨
user.password_hash = PasswordHelper.hash_password(password)
if PasswordHelper.verify_password(input_password, user.password_hash):
    # å¯†ç æ­£ç¡®
```

**å®‰å…¨ç‰¹æ€§ï¼š**
- æ¯ä¸ªå¯†ç éƒ½ç”¨ç‹¬ç«‹çš„ç›åŠ å¯†
- è®¡ç®—å¤æ‚åº¦ = 2^12 æ¬¡è¿­ä»£ï¼ˆé˜²æš´åŠ›ç ´è§£ï¼‰
- æ°¸ä¸æ˜æ–‡å­˜å‚¨æˆ–è¾“å‡ºæ—¥å¿—

---

## ğŸ“¦ å·¥ç¨‹é‡ä¸ä¼˜å…ˆçº§åˆ†æ

| é˜¶æ®µ | ä»»åŠ¡ | å·¥ç¨‹é‡ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
|------|------|--------|--------|------|
| 1 | æ•°æ®åº“ + ORM + å…³ç³»å®šä¹‰ | 1.5å¤© | P0 | âœ… å®Œæˆ |
| 2 | ç”¨æˆ·è®¤è¯ï¼ˆæ³¨å†Œ/ç™»å½•/Tokenï¼‰ | 2å¤© | P0 | âœ… å®Œæˆ |
| 3 | å•†å“ç®¡ç†ï¼ˆå‘å¸ƒ/æœç´¢/è¯¦æƒ…ï¼‰ | 2.5å¤© | P0 | âœ… å®Œæˆ |
| 4 | ç”¨æˆ·èµ„æ–™ï¼ˆè·å–/æ›´æ–°/è¯„åˆ†ï¼‰ | 1.5å¤© | P1 | âœ… å®Œæˆ |
| 5 | **è®¢å•ä¸äº‹åŠ¡ï¼ˆå…³é”®ï¼ï¼‰** | **3å¤©** | **P0** | ğŸ”„ éƒ¨åˆ†å®ç° |
| 6 | è´­ç‰©è½¦ï¼ˆSessionç®¡ç†ï¼‰ | 1å¤© | P1 | â³ å‰ç«¯å·²å®ç° |
| 7 | è¯„ä»·ç³»ç»Ÿï¼ˆåˆ›å»º/æŸ¥è¯¢ï¼‰ | 1.5å¤© | P2 | â³ ç»“æ„å·²å®š |
| 8 | æµ‹è¯•ä¸ä¼˜åŒ– | 2å¤© | P1 | ğŸ”„ è¿›è¡Œä¸­ |
| **æ€»è®¡** | | **15.5å¤©** | | **~85% å®Œæˆ** |

---

## âœ… å®ç°æ£€æŸ¥æ¸…å•

### âœ… å·²å®Œæˆï¼ˆåŸºç¡€è®¾æ–½ + æ ¸å¿ƒåŠŸèƒ½ï¼‰
- [x] MySQL æ•°æ®åº“åˆ›å»º (8.0+, utf8mb4)
- [x] SQLAlchemy ORM æ¨¡å‹å®šä¹‰ï¼ˆ6ä¸ªè¡¨ + å…³ç³»ï¼‰
- [x] ç»Ÿä¸€å“åº”æ ¼å¼å‡½æ•° (`APIResponse` ç±»)
- [x] å…¨å±€é”™è¯¯å¤„ç† (`error_handler.py`)
- [x] æ•°æ®æ ¡éªŒå·¥å…· (`validators.py`)
- [x] ç”¨æˆ·æ³¨å†Œæ¥å£ï¼ˆé‚®ç®±éªŒè¯ @seu.edu.cnï¼‰
- [x] ç”¨æˆ·ç™»å½•æ¥å£ï¼ˆJWT Token, HS256, 168hrè¿‡æœŸï¼‰
- [x] å¯†ç å®‰å…¨å­˜å‚¨ï¼ˆbcrypt, rounds=12ï¼‰
- [x] TokenéªŒè¯ä¸­é—´ä»¶ (`@auth_required`)
- [x] ç”¨æˆ·ä¿¡æ¯è·å– (GET `/api/users/current`)
- [x] å•†å“å‘å¸ƒæ¥å£ (POST `/api/item/publish`)
- [x] å•†å“æœç´¢ï¼ˆéå¤§å°å†™æ•æ„Ÿï¼Œæ”¯æŒå¤šç»´åº¦ç­›é€‰ï¼‰
- [x] å•†å“åˆ†ç±»æµè§ˆ
- [x] å•†å“è¯¦æƒ…æŸ¥è¯¢
- [x] åº“å­˜ç®¡ç†ï¼ˆstockå­—æ®µï¼‰
- [x] æ•°æ®åº“ç´¢å¼•ä¼˜åŒ– (category, price, created_at, full-text)
- [x] ç”¨æˆ·å/é‚®ç®±å¯ç”¨æ€§æ£€æŸ¥
- [x] ç”¨æˆ·èµ„æ–™æ›´æ–°
- [x] ç”¨æˆ·è¯„åˆ†è®¡ç®—ï¼ˆåŸºäºreviewsï¼‰
- [x] å•†å“æ›´æ–°/åˆ é™¤ï¼ˆæƒé™æ§åˆ¶ï¼‰

### ğŸ”„ éƒ¨åˆ†å®ç°ï¼ˆéœ€å®Œæˆæ ¸å¿ƒæ–¹æ³•ï¼‰
- [x] OrderService ç±»ç»“æ„å·²å®šä¹‰
- [x] Order/OrderItem æ•°æ®æ¨¡å‹å®Œæ•´
- [x] Address æ•°æ®æ¨¡å‹å®Œæ•´
- [ ] OrderService.create_order() - äº‹åŠ¡å¤„ç†âœ¨
- [ ] OrderService.get_orders() - è®¢å•åˆ—è¡¨
- [ ] OrderService.get_order_detail() - è®¢å•è¯¦æƒ…
- [ ] OrderService.cancel_order() - åº“å­˜å›æ»š
- [ ] Order API ç«¯ç‚¹å…¨éƒ¨æ³¨å†Œ

### â³ å¾…å®ç°ï¼ˆç»“æ„å·²å®šä¹‰ï¼‰
- [ ] Cart API ç«¯ç‚¹ï¼ˆGET/POST/PUT/DELETEï¼‰
- [ ] Review API ç«¯ç‚¹ï¼ˆPOST/GETï¼‰
- [ ] ReviewService æ–¹æ³•å®ç°
- [ ] å¹¶å‘æµ‹è¯•å’Œæ€§èƒ½ä¼˜åŒ–

### ğŸ”’ å®‰å…¨æ£€æŸ¥æ¸…å•
- [x] å¯†ç ä½¿ç”¨bcryptåŠ å¯†ï¼Œæ°¸ä¸æ˜æ–‡å­˜å‚¨
- [x] æ‰€æœ‰è¾“å…¥è¿›è¡ŒSQLæ³¨å…¥é˜²æŠ¤ï¼ˆä½¿ç”¨SQLAlchemy ORMï¼‰
- [x] APIæ¥å£ä½¿ç”¨JWTè®¤è¯ï¼ˆBearer tokenï¼‰
- [x] æƒé™æ£€æŸ¥ï¼ˆç”¨æˆ·åªèƒ½æ“ä½œè‡ªå·±çš„æ•°æ®ï¼‰âœ…
- [x] æ•°æ®åº“äº‹åŠ¡ä¿è¯ACIDç‰¹æ€§ï¼ˆready for ordersï¼‰
- [x] æ•æ„Ÿä¿¡æ¯ï¼ˆå¯†ç ã€Tokenï¼‰ä¸åœ¨æ—¥å¿—ä¸­è¾“å‡º
- [ ] HTTPSé…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- [ ] CORSé…ç½®ï¼ˆå·²åœ¨Flaskä¸­å¯ç”¨ï¼‰
- [x] é‚®ç®±æ ¼å¼éªŒè¯ï¼ˆ@seu.edu.cnï¼‰
- [x] å¯†ç å¼ºåº¦éªŒè¯ï¼ˆ8+å­—ç¬¦ï¼Œå¤§å°å†™+æ•°å­—ï¼‰
- [ ] SQLAlchemy ORM æ¨¡å‹å®šä¹‰
- [ ] ç»Ÿä¸€å“åº”æ ¼å¼å‡½æ•°
- [ ] å…¨å±€é”™è¯¯å¤„ç†
- [ ] æ•°æ®æ ¡éªŒå·¥å…·

### ç”¨æˆ·è®¤è¯ï¼ˆP0ï¼‰
- [ ] ç”¨æˆ·æ³¨å†Œæ¥å£ï¼ˆé‚®ç®±æ ¡éªŒï¼‰
- [ ] ç”¨æˆ·ç™»å½•æ¥å£ï¼ˆJWT Tokenï¼‰
- [ ] å¯†ç å®‰å…¨å­˜å‚¨ï¼ˆbcryptï¼‰
- [ ] TokenéªŒè¯ä¸­é—´ä»¶
- [ ] ç”¨æˆ·ä¿¡æ¯è·å–

### å•†å“ç®¡ç†ï¼ˆP0ï¼‰
- [ ] å‘å¸ƒå•†å“æ¥å£
- [ ] å•†å“æœç´¢ï¼ˆéå¤§å°å†™æ•æ„Ÿï¼‰
- [ ] åˆ†ç±»æµè§ˆ
- [ ] å•†å“è¯¦æƒ…
- [ ] åº“å­˜ç®¡ç†
- [ ] æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–

### è´­ç‰©è½¦ï¼ˆP1ï¼‰
- [ ] Session ç®¡ç†
- [ ] è´­ç‰©è½¦CRUD
- [ ] åº“å­˜å®æ—¶éªŒè¯ï¼ˆä¸æŒä¹…åŒ–ï¼‰

### è®¢å•ä¸ç»“è´¦ï¼ˆP0ï¼‰â­
- [ ] è®¢å•åˆ›å»ºï¼ˆäº‹åŠ¡å¤„ç†ï¼‰
- [ ] åº“å­˜æ‰£å‡ï¼ˆè¡Œçº§é”ï¼‰
- [ ] è®¢å•æŸ¥è¯¢
- [ ] è®¢å•å–æ¶ˆï¼ˆåº“å­˜å›æ»šï¼‰
- [ ] é…é€åœ°å€ç®¡ç†
- [ ] å¹¶å‘æµ‹è¯•

### æµ‹è¯•ä¸ä¼˜åŒ–
- [ ] å•å…ƒæµ‹è¯•
- [ ] é›†æˆæµ‹è¯•
- [ ] å‹åŠ›æµ‹è¯•ï¼ˆå¹¶å‘ä¸‹å•ï¼‰
- [ ] SQLæŸ¥è¯¢ä¼˜åŒ–
- [ ] åŠ å¯†å’Œå®‰å…¨å®¡è®¡

---

## ğŸ”’ å®‰å…¨æ£€æŸ¥æ¸…å•

- [ ] å¯†ç ä½¿ç”¨bcryptåŠ å¯†ï¼Œæ°¸ä¸æ˜æ–‡å­˜å‚¨
- [ ] æ‰€æœ‰è¾“å…¥è¿›è¡ŒSQLæ³¨å…¥é˜²æŠ¤ï¼ˆä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ï¼‰
- [ ] APIæ¥å£ä½¿ç”¨JWTè®¤è¯
- [ ] æƒé™æ£€æŸ¥ï¼ˆç”¨æˆ·åªèƒ½æ“ä½œè‡ªå·±çš„æ•°æ®ï¼‰
- [ ] æ•°æ®åº“äº‹åŠ¡ä¿è¯ACIDç‰¹æ€§
- [ ] æ•æ„Ÿä¿¡æ¯ï¼ˆå¯†ç ã€Tokenï¼‰ä¸åœ¨æ—¥å¿—ä¸­è¾“å‡º
- [ ] ä½¿ç”¨HTTPSï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- [ ] CORSé…ç½®æ­£ç¡®

---

## ğŸ› ï¸ å¼€å‘å·¥å…·é“¾ & ä¾èµ–

### å¿…éœ€ä¾èµ– (requirements.txt)
```
Flask==2.3.3                          # Webæ¡†æ¶
Flask-SQLAlchemy==3.0.5               # ORM
Flask-JWT-Extended==4.5.3             # JWTè®¤è¯
bcrypt==4.1.1                         # å¯†ç åŠ å¯†
PyMySQL==1.1.0                        # MySQLé©±åŠ¨
python-dotenv==1.0.0                  # ç¯å¢ƒå˜é‡
```

### å¼€å‘è¾…åŠ©ï¼ˆå¯é€‰ï¼‰
```bash
# æµ‹è¯•å’Œè¦†ç›–ç‡
pytest==7.4.0
pytest-cov==4.1.0

# æ•°æ®åº“è¿ç§»
Flask-Migrate==4.0.5
Alembic==1.11.1

# APIæ–‡æ¡£
Flask-RESTX==0.5.1

# æ€§èƒ½å’Œç¼“å­˜
Flask-Caching==2.0.2
redis==4.5.4

# ä»£ç è´¨é‡
flake8==6.0.0
pylint==2.17.1
```

---

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹ç¤ºä¾‹

### 1. ç”¨æˆ·æ³¨å†Œæµ‹è¯•ï¼ˆPOSTï¼‰
```bash
POST http://127.0.0.1:5000/api/user/register
Content-Type: application/json

{
  "username": "testuser123",
  "email": "testuser123@seu.edu.cn",
  "password": "SecurePass123"
}

# âœ… æˆåŠŸå“åº”
{
  "code": 0,
  "message": "æ³¨å†ŒæˆåŠŸ",
  "data": {
    "userId": 5,
    "username": "testuser123",
    "email": "testuser123@seu.edu.cn"
  },
  "timestamp": 1767112487
}

# âŒ é‚®ç®±ä¸ç¬¦åˆæ ¼å¼
{
  "code": 2,
  "message": "å‚æ•°éªŒè¯å¤±è´¥",
  "data": {"email": "é‚®ç®±å¿…é¡»ä¸º@seu.edu.cnæ ¼å¼"},
  "timestamp": 1767112488
}
```

### 2. ç”¨æˆ·ç™»å½•æµ‹è¯•ï¼ˆPOSTï¼‰
```bash
POST http://127.0.0.1:5000/api/user/login
Content-Type: application/json

{
  "username": "testuser123",
  "password": "SecurePass123"
}

# âœ… æˆåŠŸå“åº”
{
  "code": 0,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": 5,
      "username": "testuser123",
      "email": "testuser123@seu.edu.cn",
      "avatar": "",
      "rating": 5.0
    }
  },
  "timestamp": 1767112488
}
```

### 3. å•†å“æœç´¢æµ‹è¯•ï¼ˆPOSTï¼‰
```bash
POST http://127.0.0.1:5000/api/item/search
Content-Type: application/json

{
  "query": "è®¡ç®—æœº",
  "type": "title",
  "category": "books",
  "minPrice": 10,
  "maxPrice": 100,
  "sort": "price-asc",
  "page": 1,
  "limit": 12
}

# âœ… æˆåŠŸå“åº”
{
  "code": 0,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "items": [
      {
        "id": 1,
        "title": "è®¡ç®—æœºå¯¼è®º",
        "description": "2023å¹´æ–°ç‰ˆ...",
        "price": 45.50,
        "stock": 5,
        "image": "...",
        "category": "books",
        "seller_id": 2,
        "seller_name": "john_doe",
        "seller_rating": 4.8,
        "views": 123,
        "created_at": "2025-01-02T10:30:00"
      }
    ],
    "pagination": {
      "current_page": 1,
      "total_pages": 3,
      "total_items": 28,
      "page_size": 12
    }
  },
  "timestamp": 1767112500
}
```

### 4. å‘å¸ƒå•†å“æµ‹è¯•ï¼ˆPOSTï¼Œéœ€è®¤è¯ï¼‰
```bash
POST http://127.0.0.1:5000/api/item/publish
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiI...

{
  "title": "é«˜ç­‰æ•°å­¦æ•™æ",
  "description": "å…¨æ–°æœªä½¿ç”¨ï¼Œæ¸…åç‰ˆ",
  "category": "books",
  "price": 65.00,
  "stock": 3,
  "image_url": "https://..."
}

# âœ… æˆåŠŸå“åº”
{
  "code": 0,
  "message": "å‘å¸ƒæˆåŠŸ",
  "data": {
    "itemId": 42,
    "title": "é«˜ç­‰æ•°å­¦æ•™æ",
    "seller_id": 5,
    "created_at": "2025-01-02T11:00:00"
  },
  "timestamp": 1767112600
}

# âŒ æœªç™»å½•
{
  "code": 3,
  "message": "è¯·å…ˆç™»å½•",
  "data": null,
  "timestamp": 1767112601
}
```

### 5. åˆ›å»ºè®¢å•æµ‹è¯•ï¼ˆPOSTï¼Œéœ€è®¤è¯ï¼‰â­ **å…³é”®æµ‹è¯•**
```bash
POST http://127.0.0.1:5000/api/orders
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiI...

{
  "items": [
    {"item_id": 1, "quantity": 2},
    {"item_id": 5, "quantity": 1}
  ],
  "address_id": 1
}

# âœ… è®¢å•åˆ›å»ºæˆåŠŸ
{
  "code": 0,
  "message": "è®¢å•åˆ›å»ºæˆåŠŸ",
  "data": {
    "orderId": 101,
    "buyer_id": 5,
    "total_amount": 125.50,
    "status": "pending",
    "items": [
      {"item_id": 1, "quantity": 2, "price": 45.50},
      {"item_id": 5, "quantity": 1, "price": 34.50}
    ],
    "created_at": "2025-01-02T11:15:00"
  },
  "timestamp": 1767112700
}

# âŒ åº“å­˜ä¸è¶³
{
  "code": 1,
  "message": "å•†å“ ã€Šé«˜ç­‰æ•°å­¦ã€‹ åº“å­˜ä¸è¶³ï¼ˆå‰©ä½™2ï¼Œéœ€è¦5ï¼‰",
  "data": null,
  "timestamp": 1767112701
}

# âŒ éƒ¨åˆ†å•†å“åº“å­˜ä¸è¶³
{
  "code": 1,
  "message": "ä»¥ä¸‹å•†å“åº“å­˜ä¸è¶³ï¼šitem_id=2 (éœ€5ï¼Œå‰©2)",
  "data": null,
  "timestamp": 1767112702
}
```

### 6. å¹¶å‘ä¸‹å•æµ‹è¯•ï¼ˆé˜²æ­¢è¶…å–ï¼‰
```bash
#!/bin/bash
# æ¨¡æ‹Ÿ10ä¸ªå¹¶å‘ç”¨æˆ·è®¢è´­åŒä¸€ä»¶ä»…æœ‰5ä¸ªåº“å­˜çš„å•†å“

TOKEN="eyJhbGciOiJIUzI1NiI..."
ITEM_ID=1
STOCK=5

for i in {1..10}; do
  curl -X POST http://127.0.0.1:5000/api/orders \
    -H "Authorization: Bearer $TOKEN" \
    -H "Content-Type: application/json" \
    -d "{\"items\":[{\"item_id\":$ITEM_ID,\"quantity\":1}],\"address_id\":1}" \
    &
done
wait

# æ£€æŸ¥ç»“æœ
mysql seu_trading -e "SELECT id, stock FROM items WHERE id = $ITEM_ID;"
# åº”è¯¥è¾“å‡ºï¼š
# id  | stock
# 1   | 0      âœ… æ°å¥½å–å‡º5ä»¶ï¼Œä¸ä¼šè´Ÿæ•°æˆ–è¶…å–
```

### 7. è·å–ç”¨æˆ·ä¿¡æ¯æµ‹è¯•ï¼ˆGETï¼Œéœ€è®¤è¯ï¼‰
```bash
GET http://127.0.0.1:5000/api/users/current
Authorization: Bearer eyJhbGciOiJIUzI1NiI...

# âœ… æˆåŠŸå“åº”
{
  "code": 0,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "id": 5,
    "username": "testuser123",
    "email": "testuser123@seu.edu.cn",
    "phone": "13800138000",
    "avatar": "https://...",
    "bio": "æ ¡å›­äºŒæ‰‹äº¤æ˜“çˆ±å¥½è€…",
    "rating": 4.8,
    "total_reviews": 12,
    "seller_count": 8,
    "buyer_count": 15,
    "created_at": "2025-12-31T10:00:00"
  },
  "timestamp": 1767112800
}
```

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨æ­¥éª¤

## ğŸš€ å¿«é€Ÿå¯åŠ¨æ­¥éª¤

### 1. åˆ›å»ºæ•°æ®åº“ä¸åˆå§‹åŒ–
```bash
# åˆ›å»ºæ•°æ®åº“ï¼ˆUTF-8æ”¯æŒï¼‰
mysql -u root -p -e "CREATE DATABASE seu_trading CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"

# å¯¼å…¥æ•°æ®åº“ç»“æ„
mysql -u root -p seu_trading < database/schema.sql

# å¯¼å…¥æµ‹è¯•æ•°æ®ï¼ˆå¯é€‰ï¼‰
mysql -u root -p seu_trading < database/seed_data.sql
```

### 2. å®‰è£…Pythonä¾èµ–
```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
# Windows
venv\Scripts\activate
# Mac/Linux
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### 3. é…ç½®ç¯å¢ƒå˜é‡
```bash
# å¤åˆ¶ç¤ºä¾‹æ–‡ä»¶
cp .env.example .env

# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½®æ•°æ®åº“è¿æ¥
# DATABASE_URI=mysql+pymysql://root:password@localhost:3306/seu_trading?charset=utf8mb4
# SECRET_KEY=your-secret-key-here
# JWT_SECRET_KEY=your-jwt-secret
```

### 4. å¯åŠ¨åº”ç”¨
```bash
# Windows
start-dev.bat

# Mac/Linux
python run.py

# è®¿é—®ï¼šhttp://localhost:5000
```

### 5. æµ‹è¯•APIï¼ˆä½¿ç”¨curlæˆ–Postmanï¼‰
```bash
# 1. æ³¨å†Œç”¨æˆ·
curl -X POST http://localhost:5000/api/user/register \
  -H "Content-Type: application/json" \
  -d '{"username":"test","email":"test@seu.edu.cn","password":"Test123456"}'

# 2. ç™»å½•è·å–token
TOKEN=$(curl -X POST http://localhost:5000/api/user/login \
  -H "Content-Type: application/json" \
  -d '{"username":"test","password":"Test123456"}' \
  | jq -r '.data.token')

# 3. ä½¿ç”¨tokenè®¿é—®å—ä¿æŠ¤çš„æ¥å£
curl -X GET http://localhost:5000/api/users/current \
  -H "Authorization: Bearer $TOKEN"
```

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

| æ–‡ä»¶ | å†…å®¹ | ç”¨é€” |
|------|------|------|
| [CLAUDE.md](CLAUDE.md) | å½“å‰æ–‡ä»¶ - åç«¯å®ç°å®Œæ•´è¯´æ˜ | AIç¼–ç æŒ‡å— |
| [README.md](README.md) | é¡¹ç›®æ€»ä½“æè¿° | é¡¹ç›®æ¦‚è§ˆ |
| [å‰ç«¯è®¾è®¡.md](å‰ç«¯è®¾è®¡.md) | å‰ç«¯é¡µé¢è®¾è®¡è§„èŒƒ | å‰ç«¯å¼€å‘ |
| [database/schema.sql](database/schema.sql) | æ•°æ®åº“å®Œæ•´ç»“æ„ï¼ˆå«æ³¨é‡Šï¼‰ | æ•°æ®åº“è®¾è®¡ |
| [database/seed_data.sql](database/seed_data.sql) | æµ‹è¯•æ•°æ® | å¼€å‘æµ‹è¯• |
| [app/models.py](app/models.py) | SQLAlchemy ORMå®šä¹‰ | æ•°æ®å»ºæ¨¡ |
| [app/services/](app/services/) | ä¸šåŠ¡é€»è¾‘å®ç° | æ ¸å¿ƒé€»è¾‘ |
| [app/api/](app/api/) | APIç«¯ç‚¹å®ç° | APIå¼€å‘ |

---

## ğŸ’¡ å¸¸è§é—®é¢˜è§£ç­”

### Q: è´­ç‰©è½¦æ•°æ®å­˜åœ¨å“ªé‡Œï¼Ÿ
**A:** Flask Sessionï¼ˆå†…å­˜ï¼‰ï¼Œé€šè¿‡å‰ç«¯ sessionStorage ç®¡ç†ï¼Œæ–­å¼€è¿æ¥æˆ–æµè§ˆå™¨å…³é—­æ—¶æ¸…ç©ºã€‚ä¸å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼ˆæŒ‰é¡¹ç›®è¦æ±‚ï¼‰ã€‚

### Q: å¦‚ä½•å¤„ç†å¹¶å‘ä¸‹å•çš„åº“å­˜å†²çªï¼Ÿ
**A:** ä½¿ç”¨ `db.session.with_for_update()` è¿›è¡Œè¡Œçº§é”å®šï¼Œä¿è¯åœ¨äº‹åŠ¡ä¸­åº“å­˜çš„åŸå­æ€§æ“ä½œã€‚ç»“åˆ SELECT FOR UPDATE å’Œäº‹åŠ¡COMMIT/ROLLBACK å®ç°ACIDç‰¹æ€§ã€‚

### Q: å¦‚ä½•æ¢å¤å–æ¶ˆè®¢å•çš„åº“å­˜ï¼Ÿ
**A:** åœ¨ `OrderService.cancel_order()` ä¸­å¼€å¯æ–°äº‹åŠ¡ï¼Œæ ¹æ® OrderItem è®°å½•å°†åº“å­˜åŠ å›ï¼š
```python
item.stock += order_item.quantity
db.session.commit()
```

### Q: æœç´¢åŠŸèƒ½å¦‚ä½•å®ç°éå¤§å°å†™æ•æ„Ÿï¼Ÿ
**A:** é€šè¿‡ MySQL COLLATE utf8mb4_unicode_ci å®ç°ï¼ˆå·²åœ¨ schema.sql ä¸­é…ç½®ï¼‰ï¼Œæˆ–ä½¿ç”¨ SQLAlchemy çš„ `ilike()` æ–¹æ³•ï¼š
```python
Item.query.filter(Item.title.ilike(f'%{query}%'))
```

### Q: å¦‚ä½•éªŒè¯ @seu.edu.cn é‚®ç®±ï¼Ÿ
**A:** åœ¨ User æ¨¡å‹ä¸­ä½¿ç”¨ @validates è£…é¥°å™¨ï¼š
```python
@validates('email')
def validate_email(self, key, email):
    if not email.endswith('@seu.edu.cn'):
        raise ValueError('é‚®ç®±å¿…é¡»ä¸º@seu.edu.cnæ ¼å¼')
    return email
```

### Q: JWT Token å¦‚ä½•ä½¿ç”¨ï¼Ÿ
**A:** 
```python
# ç”Ÿæˆ token
token = generate_token(user_id=user.id)  # app/utils/jwt_helper.py

# å®¢æˆ·ç«¯å­˜å‚¨å¹¶åœ¨è¯·æ±‚å¤´ä¸­ä½¿ç”¨
Authorization: Bearer <token>

# æœåŠ¡å™¨éªŒè¯
payload = verify_token(token)  # è¿”å›user_idæˆ–None
```

### Q: å¦‚ä½•æµ‹è¯•å—ä¿æŠ¤çš„APIç«¯ç‚¹ï¼Ÿ
**A:** 
```bash
# ä½¿ç”¨ curl
curl -X GET http://localhost:5000/api/users/current \
  -H "Authorization: Bearer <your_token_here>"

# ä½¿ç”¨ Postman
# 1. åœ¨ Headers æ ‡ç­¾é¡µæ·»åŠ ï¼šKey="Authorization", Value="Bearer <token>"
# 2. å‘é€è¯·æ±‚
```

### Q: æ•°æ®åº“è¿æ¥å¤±è´¥æ€ä¹ˆåŠï¼Ÿ
**A:** æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. MySQL æœåŠ¡æ˜¯å¦å¯åŠ¨ï¼š`mysql -u root -p -e "SELECT 1;"`
2. æ•°æ®åº“æ˜¯å¦åˆ›å»ºï¼š`mysql -u root -p -e "SHOW DATABASES;" | grep seu_trading`
3. `.env` ä¸­çš„ DATABASE_URI æ˜¯å¦æ­£ç¡®
4. ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®
5. æ•°æ®åº“å­—ç¬¦é›†æ˜¯å¦ä¸º utf8mb4ï¼š`SHOW CREATE DATABASE seu_trading;`

---

## ğŸ” è°ƒè¯•æŠ€å·§

### å¯ç”¨SQLAlchemyæŸ¥è¯¢æ—¥å¿—
```python
# app/__init__.py
app.config['SQLALCHEMY_ECHO'] = True  # æ‰“å°æ‰€æœ‰SQLè¯­å¥
```

### ä½¿ç”¨Flaskè°ƒè¯•å·¥å…·æ 
```bash
pip install flask-debugtoolbar
# éœ€è¦åœ¨ app/__init__.py ä¸­é…ç½®
```

### æ•°æ®åº“å¿«é€ŸæŸ¥è¯¢
```bash
# è¿æ¥æ•°æ®åº“
mysql seu_trading -u root -p

# å¸¸ç”¨æŸ¥è¯¢
SELECT * FROM users LIMIT 5;
SELECT COUNT(*) FROM items WHERE is_active = 1;
SELECT * FROM orders WHERE buyer_id = 5 ORDER BY created_at DESC;
SELECT * FROM order_items WHERE order_id = 101;
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0 (æ›´æ–°äº 2025-01-02)  
**æ›´æ–°å†…å®¹**: è¡¥å……äº†å®Œæ•´çš„å®ç°ç»†èŠ‚ã€APIè§„èŒƒã€æµ‹è¯•ç”¨ä¾‹ã€å¹¶å‘å¤„ç†æ–¹æ¡ˆ  
**ç»´æŠ¤è€…**: åç«¯å¼€å‘å›¢é˜Ÿ

---

## ğŸ“Œ åç»­å¼€å‘è¦ç‚¹

### ç«‹å³éœ€è¦å®ç°
1. âœ¨ **OrderService.create_order()** - äº‹åŠ¡å¤„ç† + åº“å­˜é”
2. âœ¨ **OrderService.cancel_order()** - åº“å­˜å›æ»š
3. Cart API ç«¯ç‚¹æ³¨å†Œå’Œå®ç°
4. Orders API ç«¯ç‚¹å®Œæ•´å®ç°

### æµ‹è¯•é‡ç‚¹
1. å¹¶å‘ä¸‹å•ï¼ˆé˜²è¶…å–ï¼‰
2. å¼‚å¸¸æƒ…å†µï¼ˆåº“å­˜ä¸è¶³ã€ç”¨æˆ·ä¸å­˜åœ¨ç­‰ï¼‰
3. æƒé™æ ¡éªŒï¼ˆç”¨æˆ·åªèƒ½æ“ä½œè‡ªå·±çš„æ•°æ®ï¼‰
4. æœç´¢æ€§èƒ½ï¼ˆå¤§æ•°æ®é‡ä¸‹ï¼‰

### æ€§èƒ½ä¼˜åŒ–
1. æ•°æ®åº“è¿æ¥æ± 
2. æŸ¥è¯¢ä¼˜åŒ–ï¼ˆå·²å»ºç«‹ç´¢å¼•ï¼‰
3. ç¼“å­˜çƒ­ç‚¹æ•°æ®ï¼ˆRedisï¼‰
4. æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æ

åç«¯ç”¨æˆ·ä¸å•†å“æ¨¡å—apiæµ‹è¯•
APIæµ‹è¯•æ—¥å¿— - å¼€å§‹æ—¶é—´: 2025-12-31 00:34:47.409560
æµ‹è¯•åœ°å€: http://127.0.0.1:5000
==================================================
å¼€å§‹è¿è¡ŒAPIæµ‹è¯•...

==================================================
1. æµ‹è¯•ç”¨æˆ·æ³¨å†Œæ¥å£
==================================================
å“åº”æ—¶é—´: 2025-12-31 00:34:47.683613
è¯·æ±‚: POST http://127.0.0.1:5000/api/user/register
è¯·æ±‚æ•°æ®: {
  "username": "testuser_py",
  "email": "testuser_py@seu.edu.cn",
  "password": "Test123456"
}
çŠ¶æ€ç : 200
å“åº”å†…å®¹:
{
  "code": 0,
  "data": {
    "email": "testuser_py@seu.edu.cn",
    "userId": 4,
    "username": "testuser_py"
  },
  "message": "æ³¨å†ŒæˆåŠŸ",
  "timestamp": 1767112487
}

==================================================
2. æµ‹è¯•ç”¨æˆ·ç™»å½•æ¥å£
==================================================
å“åº”æ—¶é—´: 2025-12-31 00:34:48.913639
è¯·æ±‚: POST http://127.0.0.1:5000/api/user/login
è¯·æ±‚æ•°æ®: {
  "username": "testuser_py",
  "password": "Test123456"
}
çŠ¶æ€ç : 200
å“åº”å†…å®¹:
{
  "code": 0,
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjo0LCJleHAiOjE3Njc3MTcyODgsImlhdCI6MTc2NzExMjQ4OH0.mJXhCo8pt9UPbElWw_1YWjwaxVM3jdqYg0KbnMQpKSI",
    "user": {
      "avatar": "",
      "email": "testuser_py@seu.edu.cn",
      "id": 4,
      "rating": 5.0,
      "username": "testuser_py"
    }
  },
  "message": "ç™»å½•æˆåŠŸ",
  "timestamp": 1767112488
}
Tokenæå–æˆåŠŸ: eyJhbGciOiJIUzI1NiIs...
ç”¨æˆ·ID: 4

==================================================
3. æµ‹è¯•æ£€æŸ¥ç”¨æˆ·åå¯ç”¨æ€§
==================================================
å“åº”æ—¶é—´: 2025-12-31 00:34:49.927222
è¯·æ±‚: GET http://127.0.0.1:5000/api/user/checkUsername/testuser_py
çŠ¶æ€ç : 200
å“åº”å†…å®¹:
{
  "code": 0,
  "data": {
    "available": false
  },
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "timestamp": 1767112489
}
å“åº”æ—¶é—´: 2025-12-31 00:34:49.935847
è¯·æ±‚: GET http://127.0.0.1:5000/api/user/checkUsername/newuser_py
çŠ¶æ€ç : 200
å“åº”å†…å®¹:
{
  "code": 0,
  "data": {
    "available": true
  },
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "timestamp": 1767112489
}

==================================================
4. æµ‹è¯•æ£€æŸ¥é‚®ç®±å¯ç”¨æ€§
==================================================
å“åº”æ—¶é—´: 2025-12-31 00:34:50.449032
è¯·æ±‚: GET http://127.0.0.1:5000/api/user/checkEmail/testuser_py@seu.edu.cn
çŠ¶æ€ç : 200
å“åº”å†…å®¹:
{
  "code": 0,
  "data": {
    "available": false
  },
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "timestamp": 1767112490
}
å“åº”æ—¶é—´: 2025-12-31 00:34:50.460040
è¯·æ±‚: GET http://127.0.0.1:5000/api/user/checkEmail/newuser_py@seu.edu.cn
çŠ¶æ€ç : 200
å“åº”å†…å®¹:
{
  "code": 0,
  "data": {
    "available": true
  },
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "timestamp": 1767112490
}

==================================================
5. æµ‹è¯•è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
==================================================
å“åº”æ—¶é—´: 2025-12-31 00:34:50.975499
è¯·æ±‚: GET http://127.0.0.1:5000/api/user/getCurrentUser
çŠ¶æ€ç : 200
å“åº”å†…å®¹:
{
  "code": 0,
  "data": {
    "created_at": "2025-12-31T00:34:48",
    "email": "testuser_py@seu.edu.cn",
    "id": 4,
    "rating": 5.0,
    "stats": {
      "favorites": 0,
      "published": 0,
      "sold": 0
    },
    "username": "testuser_py"
  },
  "message": "è·å–æˆåŠŸ",
  "timestamp": 1767112490
}

==================================================
6. æµ‹è¯•è·å–ç”¨æˆ·å…¬å¼€èµ„æ–™
==================================================
å“åº”æ—¶é—´: 2025-12-31 00:34:51.498888
è¯·æ±‚: GET http://127.0.0.1:5000/api/user/getUserProfile/1
çŠ¶æ€ç : 200
å“åº”å†…å®¹:
{
  "code": 0,
  "data": {
    "avatar": "",
    "id": 1,
    "rating": 5.0,
    "stats": {
      "favorites": 0,
      "published": 1,
      "sold": 0
    },
    "username": "test_flask"
  },
  "message": "è·å–æˆåŠŸ",
  "timestamp": 1767112491
}

==================================================
7. æµ‹è¯•è·å–é¦–é¡µæ¨èå•†å“
==================================================
å“åº”æ—¶é—´: 2025-12-31 00:34:52.012490
è¯·æ±‚: POST http://127.0.0.1:5000/api/item/getFeatured
è¯·æ±‚æ•°æ®: {
  "limit": 5
}
çŠ¶æ€ç : 200
å“åº”å†…å®¹:
{
  "code": 0,
  "data": [
    {
      "category": "electronics",
      "created_at": "2025-12-31T00:02:22",
      "description": "8æˆæ–°ï¼ŒåŠŸèƒ½æ­£å¸¸",
      "id": 1,
      "image": "",
      "price": 2999.0,
      "seller_id": 1,
      "seller_name": "test_flask",
      "seller_rating": 5.0,
      "stock": 0,
      "title": "äºŒæ‰‹ç¬”è®°æœ¬ç”µè„‘",
      "views": 1
    }
  ],
  "message": "è·å–æˆåŠŸ",
  "timestamp": 1767112492
}

==================================================
8. æµ‹è¯•æœç´¢å•†å“
==================================================
å“åº”æ—¶é—´: 2025-12-31 00:34:52.531134
è¯·æ±‚: POST http://127.0.0.1:5000/api/item/search
è¯·æ±‚æ•°æ®: {
  "query": "ç¬”è®°æœ¬",
  "type": "title",
  "page": 1,
  "limit": 10,
  "sort": "latest"
}
çŠ¶æ€ç : 200
å“åº”å†…å®¹:
{
  "code": 0,
  "data": {
    "items": [
      {
        "category": "electronics",
        "created_at": "2025-12-31T00:02:22",
        "description": "8æˆæ–°ï¼ŒåŠŸèƒ½æ­£å¸¸",
        "id": 1,
        "image": "",
        "price": 2999.0,
        "seller_id": 1,
        "seller_name": "test_flask",
        "seller_rating": 5.0,
        "stock": 0,
        "title": "äºŒæ‰‹ç¬”è®°æœ¬ç”µè„‘",
        "views": 1
      }
    ],
    "pagination": {
      "current_page": 1,
      "page_size": 10,
      "total_items": 1,
      "total_pages": 1
    }
  },
  "message": "æœç´¢æˆåŠŸ",
  "timestamp": 1767112492
}

==================================================
9. æµ‹è¯•å‘å¸ƒæ–°å•†å“
==================================================
å“åº”æ—¶é—´: 2025-12-31 00:34:53.056856
è¯·æ±‚: POST http://127.0.0.1:5000/api/item/create
è¯·æ±‚æ•°æ®: {
  "title": "Pythonæµ‹è¯•å•†å“",
  "description": "è¿™æ˜¯ä½¿ç”¨Pythonè„šæœ¬æµ‹è¯•å‘å¸ƒçš„å•†å“",
  "price": 1999.99,
  "stock": 10,
  "category": "electronics",
  "images": [
    "https://example.com/test.jpg"
  ]
}
çŠ¶æ€ç : 200
å“åº”å†…å®¹:
{
  "code": 0,
  "data": {
    "category": "electronics",
    "created_at": "2025-12-31T00:34:53",
    "description": "è¿™æ˜¯ä½¿ç”¨Pythonè„šæœ¬æµ‹è¯•å‘å¸ƒçš„å•†å“",
    "favorites": 0,
    "id": 2,
    "image": "https://example.com/test.jpg",
    "images": [
      "https://example.com/test.jpg"
    ],
    "price": 1999.99,
    "seller_email": "testuser_py@seu.edu.cn",
    "seller_id": 4,
    "seller_name": "testuser_py",
    "seller_rating": 5.0,
    "seller_verified": true,
    "stock": 10,
    "title": "Pythonæµ‹è¯•å•†å“",
    "views": 0
  },
  "message": "å‘å¸ƒæˆåŠŸ",
  "timestamp": 1767112493
}
å•†å“ID: 2

==================================================
10. æµ‹è¯•è·å–å•†å“è¯¦æƒ…
==================================================
å“åº”æ—¶é—´: 2025-12-31 00:34:54.080445
è¯·æ±‚: GET http://127.0.0.1:5000/api/item/getDetail/2
çŠ¶æ€ç : 200
å“åº”å†…å®¹:
{
  "code": 0,
  "data": {
    "category": "electronics",
    "created_at": "2025-12-31T00:34:53",
    "description": "è¿™æ˜¯ä½¿ç”¨Pythonè„šæœ¬æµ‹è¯•å‘å¸ƒçš„å•†å“",
    "favorites": 0,
    "id": 2,
    "image": "https://example.com/test.jpg",
    "images": [
      "https://example.com/test.jpg"
    ],
    "price": 1999.99,
    "seller_email": "testuser_py@seu.edu.cn",
    "seller_id": 4,
    "seller_name": "testuser_py",
    "seller_rating": 5.0,
    "seller_verified": true,
    "stock": 10,
    "title": "Pythonæµ‹è¯•å•†å“",
    "views": 1
  },
  "message": "è·å–æˆåŠŸ",
  "timestamp": 1767112494
}

==================================================
11. æµ‹è¯•æ›´æ–°å•†å“ä¿¡æ¯
==================================================
å“åº”æ—¶é—´: 2025-12-31 00:34:54.608266
è¯·æ±‚: POST http://127.0.0.1:5000/api/item/update/2
è¯·æ±‚æ•°æ®: {
  "title": "Pythonæµ‹è¯•å•†å“ï¼ˆå·²æ›´æ–°ï¼‰",
  "price": 1899.99,
  "description": "è¿™æ˜¯æ›´æ–°åçš„å•†å“æè¿°"
}
çŠ¶æ€ç : 200
å“åº”å†…å®¹:
{
  "code": 0,
  "data": {
    "category": "electronics",
    "created_at": "2025-12-31T00:34:53",
    "description": "è¿™æ˜¯æ›´æ–°åçš„å•†å“æè¿°",
    "favorites": 0,
    "id": 2,
    "image": "https://example.com/test.jpg",
    "images": [
      "https://example.com/test.jpg"
    ],
    "price": 1899.99,
    "seller_email": "testuser_py@seu.edu.cn",
    "seller_id": 4,
    "seller_name": "testuser_py",
    "seller_rating": 5.0,
    "seller_verified": true,
    "stock": 10,
    "title": "Pythonæµ‹è¯•å•†å“ï¼ˆå·²æ›´æ–°ï¼‰",
    "views": 2
  },
  "message": "æ›´æ–°æˆåŠŸ",
  "timestamp": 1767112494
}

==================================================
12. æµ‹è¯•æ‰¹é‡æ£€æŸ¥åº“å­˜
==================================================
å“åº”æ—¶é—´: 2025-12-31 00:29:07
å“åº”å†…å®¹:
{
  "code": 0,
  "data": {
    "items": [
      {
        "available": false,
        "itemId": 1,
        "stock": 0
      },
      {
        "available": false,
        "itemId": 2,
        "stock": 0
      },
      {
        "available": false,
        "itemId": 999,
        "stock": 0
      }
    ],
    "valid": false
  },
  "message": "\u68c0\u67e5\u6210\u529f",
  "timestamp": 1767112147
}


==================================================
13. æµ‹è¯•ç”¨æˆ·ç™»å‡º
==================================================
å“åº”æ—¶é—´: 2025-12-31 00:34:55.634112
è¯·æ±‚: POST http://127.0.0.1:5000/api/user/logout
çŠ¶æ€ç : 200
å“åº”å†…å®¹:
{
  "code": 0,
  "data": {},
  "message": "ç™»å‡ºæˆåŠŸ",
  "timestamp": 1767112495
}

==================================================
æµ‹è¯•å®Œæˆ
==================================================
è¯¦ç»†æ—¥å¿—å·²ä¿å­˜åˆ°: api_test_results_20251231_003447.log

âœ… æ‰€æœ‰æµ‹è¯•å®Œæˆï¼
ğŸ“„ è¯¦ç»†æ—¥å¿—: api_test_results_20251231_003447.log